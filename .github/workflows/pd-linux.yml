name: Build Pd Externals for Linux
on: [push, pull_request]
jobs:
  pd-linux:
    runs-on: ubuntu-latest
    steps:
      - name: install Ubuntu packages
        run: |
          sudo apt-get install --no-install-recommends puredata-dev
      - name: checkout flext
        uses: actions/checkout@v2
        with:
          repository:  grrrr/flext
          path: flext
      - name: build and install flext
        working-directory: flext
        run: |
          ./build.sh pd gcc || true
          ./build.sh pd gcc || true
          ./build.sh pd gcc
          sudo ./build.sh pd gcc install
      - name: checkout APF source code
        uses: actions/checkout@v2
        with:
          path: apf
      - name: build Pd externals
        working-directory: apf/examples
        run: |
          make pd FLEXTPATH="$GITHUB_WORKSPACE/flext"
